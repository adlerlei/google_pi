<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>樹莓派內容管理後台</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bulma.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        /* 初始隱藏進度條 */
        #upload-progress-container {
            display: none;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <section class="section">
        <div class="container">
            <h1 class="title has-text-centered">樹莓派內容管理系統</h1>
            <p class="subtitle has-text-centered">
                管理將在樹莓派上顯示的圖片與影片。
            </p>

            <div class="box mt-5">
                <form id="uploadForm" action="{{ url_for('add_media_item') }}" method="POST" enctype="multipart/form-data">
                    <div class="field">
                        <label class="label">媒體類型</label>
                        <div class="control">
                            <div class="select is-fullwidth">
                                <select name="type" required>
                                    <option value="image">圖片 (Image)</option>
                                    <option value="video">影片 (Video)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="field">
                        <label class="label">指定區塊</label>
                        <div class="control">
                            <div class="select is-fullwidth">
                                <select name="section_key" required>
                                    <option value="" disabled selected>-- 請選擇區塊 --</option>
                                    {% for key, name in available_sections.items() %}
                                    <option value="{{ key }}">{{ name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="field">
                        <label class="label">選擇檔案</label>
                        <div class="control">
                            <div class="file has-name is-fullwidth">
                                <label class="file-label">
                                    <input class="file-input" type="file" name="file" required>
                                    <span class="file-cta">
                                        <span class="file-icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M9.99999 12.5C10.2267 12.5 10.4433 12.4208 10.6067 12.2792L12.9325 10.2042C13.0002 10.1445 13.0552 10.0716 13.0945 9.98987C13.1338 9.90811 13.1566 9.81926 13.1617 9.72833C13.1667 9.63741 13.1539 9.54667 13.1242 9.46167C13.0944 9.37667 13.0483 9.29917 12.9883 9.23417C12.9283 9.16917 12.8558 9.1175 12.7742 9.08167C12.6925 9.04583 12.6042 9.0275 12.5142 9.0275C12.4242 9.0275 12.3358 9.04583 12.2542 9.08167C12.1725 9.1175 12.1 9.16917 12.04 9.23417L9.71416 11.3092C9.64644 11.3688 9.59149 11.4417 9.55222 11.5235C9.51295 11.6052 9.49017 11.6941 9.48506 11.785C9.48006 11.8759 9.49278 11.9667 9.52256 12.0517C9.55233 12.1367 9.59844 12.2142 9.65833 12.2792C9.71833 12.3442 9.79083 12.3958 9.87249 12.4317C9.95416 12.4675 10.0425 12.4858 10.1325 12.4858C10.2225 12.4858 10.3108 12.4675 10.3925 12.4317C10.4742 12.3958 10.5467 12.3442 10.6067 12.2792" fill="none"></path><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"></path></svg>
                                        </span>
                                        <span class="file-label">
                                            選擇檔案…
                                        </span>
                                    </span>
                                    <span class="file-name">
                                        未選擇任何檔案
                                    </span>
                                </label>
                            </div>
                        </div>
                        <p class="help">支援的圖片格式：.jpg, .jpeg, .png, .gif</p>
                        <p class="help">支援的影片格式：.mp4, .mov, .avi</p>
                    </div>

                    <div id="upload-progress-container" class="field">
                        <label class="label">上傳進度</label>
                        <progress id="upload-progress-bar" class="progress is-primary" value="0" max="100">0%</progress>
                        <span id="upload-progress-text">0%</span>
                    </div>

                    <div class="field is-grouped is-grouped-right">
                        <div class="control">
                            <button type="submit" class="button is-primary">新增媒體</button>
                        </div>
                    </div>
                </form>
            </div>

            <div class="box mt-5">
                {% if media_items %}
                <div class="table-container">
                    <table class="table is-striped is-fullwidth is-hoverable">
                        <thead>
                            <tr>
                                <th>預覽</th>
                                <th>類型</th>
                                <th>所在區塊</th>
                                <th class="has-text-right">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in media_items %}
                            <tr>
                                <td>
                                    {% if item.type == 'image' %}
                                        <figure class="image is-64x64">
                                            <img src="{{ item.url }}" alt="{{ item.filename }}" class="media-preview"
                                                 onerror="this.onerror=null; this.parentElement.innerHTML='<span class=\'icon\'><svg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'currentColor\'><path d=\'M2.5 5.5C2.5 4.39543 3.39543 3.5 4.5 3.5H19.5C20.6046 3.5 21.5 4.39543 21.5 5.5V18.5C21.5 19.6046 20.6046 20.5 19.5 20.5H4.5C3.39543 20.5 2.5 19.6046 2.5 18.5V5.5ZM4.5 4.5C3.94772 4.5 3.5 4.94772 3.5 5.5V18.5C3.5 19.0523 3.94772 19.5 4.5 19.5H19.5C20.0523 19.5 20.5 19.0523 20.5 18.5V5.5C20.5 4.94772 20.0523 4.5 19.5 4.5H4.5ZM8.5 8.5C7.94772 8.5 7.5 8.94772 7.5 9.5V11.5C7.5 12.0523 7.94772 12.5 8.5 12.5H15.5C16.0523 12.5 16.5 12.0523 16.5 11.5V9.5C16.5 8.94772 16.0523 8.5 15.5 8.5H8.5ZM15.5 9.5H8.5V11.5H15.5V9.5Z\'></path></svg></span>';">
                                        </figure>
                                    {% elif item.type == 'video' %}
                                        <span class="icon is-large has-text-info">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M4 6.49856C4 5.37731 5.01331 4.54053 6.09209 4.91627L20.0921 10.4163C21.0994 10.7663 21.7607 11.7911 21.4995 12.8301C21.4508 13.0283 21.3715 13.2152 21.2654 13.3853L21.2478 13.4138L21.0921 13.5837L21.0921 13.5837L6.09209 19.0837C5.01331 19.4595 4 18.6227 4 17.5014V6.49856ZM6 7.70144V16.2986L18.0208 12L6 7.70144Z"></path></svg>
                                        </span>
                                    {% else %}
                                        <span class="icon has-text-grey-light">
                                           <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"></path></svg>
                                        </span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if item.type == 'image' %}
                                        <span class="tag is-success is-light">圖片</span>
                                    {% elif item.type == 'video' %}
                                        <span class="tag is-info is-light">影片</span>
                                    {% else %}
                                        <span class="tag is-warning is-light">未知</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {{ available_sections.get(item.section_key, item.section_key) }}
                                </td>
                                <td class="actions-cell has-text-right">
                                    <button class="button is-small is-link is-light" disabled>編輯</button>
                                    <form action="{{ url_for('delete_media_item', media_id=item.id) }}" method="POST" onsubmit="return confirm('您確定要刪除這個媒體項目嗎？');" style="display: inline-block;">
                                        <button type="submit" class="button is-small is-danger is-light">刪除</button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="notification is-warning">
                    <p class="has-text-centered">目前沒有任何媒體項目。請使用上方表單新增。</p>
                </div>
                {% endif %}
            </div>
        </div>
    </section>

    <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
</body>
</html>