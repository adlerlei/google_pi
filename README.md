# MQ 直立式廣告機內容管理系統 (MQ Digital Signage CMS)

**最後更新日期：** 2025年6月11日

## 專案概述

本專案是一個輕量級的後台內容管理系統（CMS），專為「MQ 直立式廣告機」前端頁面設計。它提供了一個受密碼保護的管理介面，讓管理者能夠上傳媒體素材（圖片、影片）、管理輪播內容，並將這些素材即時指派到前端廣告機的特定顯示區塊。所有內容的變更都會透過 WebSocket 即時同步到前端頁面，無需重新整理。

---

## 核心功能

* **使用者認證**:
    * 透過 JWT (JSON Web Token) 保護所有後台管理 API，確保只有登入的使用者才能進行操作。
    * 提供獨立的登入頁面 (`/login`)。
    * 後台操作若 Token 失效或逾時，會自動導向回登入頁面。

* **媒體素材管理**:
    * 支援上傳**圖片** (`.jpg`, `.png`, `.gif` 等) 和**影片** (`.mp4`, `.mov` 等) 素材。
    * 所有上傳的檔案都會以唯一的 UUID 重新命名，以避免檔名衝突。
    * 提供統一的媒體列表，並可刪除不再需要的素材（刪除時會一併移除實體檔案）。

* **內容指派系統**:
    * 可將單一的圖片或影片素材**直接指派**到前端的特定區塊（頁首、頁尾）。
    * 一個區塊可以累加指派多個媒體，形成一個該區塊專屬的輪播內容。

* **輪播圖片組管理**:
    * 允許建立、命名和刪除「輪播圖片組」。
    * 提供視覺化的 Modal 彈出視窗，方便地將媒體庫中的圖片加入或移出特定的輪播組。
    * 支援在 Modal 中對輪播組內的圖片進行**拖曳排序**。

* **輪播組指派**:
    * 可將設定好的「輪播圖片組」整體指派到前端的四個中間輪播區塊。
    * 支援設定**偏移量 (Offset)**，讓輪播可以從群組中的任意一張圖片開始。
    * 對輪播區塊的指派具有**覆蓋性**，一個新的輪播組指派會取代該區塊先前所有的內容。

* **全域播放設定**:
    * 管理者可以在後台設定頁首、中間區塊、頁尾輪播的**間隔時間**（秒）。
    * 設定會儲存並應用於所有前端顯示頁面。

* **即時更新**:
    * 後台所有對媒體、指派或設定的變更，都會透過 **WebSocket** (Socket.IO) 即時通知前端。
    * 前端接收到通知後會自動重新獲取數據並更新畫面，達到內容同步的效果。

---

## 技術棧

* **後端**: Python, Flask, Flask-SQLAlchemy, Flask-SocketIO, PyJWT
* **前端**: 原生 JavaScript (ES6+), Socket.IO Client, Bulma (CSS 框架)
* **資料庫**: SQLite (用於儲存使用者帳號密碼)
* **資料儲存**: `media.json` (媒體與指派資料), `settings.json` (播放設定)

---

## 專案結構

```markdown
MQ-CMS
├── app.py                  # Flask 主應用程式
├── init_db.py              # 資料庫初始化腳本
├── media.json              # 媒體與內容指派資料檔案
├── settings.json           # 全局播放設定檔案
├── users.db                # 使用者資料庫 (SQLite)
├── requirements.txt        # Python 依賴套件
├── static/
│   ├── css/
│   │   ├── bulma.css
│   │   └── index.css
│   ├── js/
│   │   ├── admin.js        # 後台管理頁面的主要邏輯
│   │   └── animation.js    # 前端顯示頁面的動畫與資料邏輯
│   └── uploads/            # 上傳的媒體檔案存放處
└── templates/
├── admin.html          # 後台管理頁面
├── index.html          # 前端廣告機顯示頁面
└── login.html          # 登入頁面
```

---

## 安裝與啟動指南

1.  **建立虛擬環境** (建議):
    ```bash
    python -m venv venv
    source venv/bin/activate  # On Windows, use `venv\Scripts\activate`
    ```

2.  **安裝依賴套件**:
    ```bash
    pip install -r requirements.txt
    ```

3.  **初始化資料庫**:
    首次執行前，需要先建立資料庫和預設管理員帳號。
    ```bash
    python init_db.py
    ```
    這會建立 `users.db` 並新增一個預設帳號。

4.  **啟動應用程式**:
    ```bash
    python app.py
    ```

5.  **訪問應用**:
    * **前端廣告機頁面**: `http://127.0.0.1:5000/`
    * **後台登入頁面**: `http://127.0.0.1:5000/login`

---

## 預設管理員憑證

* **使用者名稱**: `admin`
* **密碼**: `password`

**安全警告**: 請在首次登入後，於資料庫中手動修改預設密碼，或建立新的管理員帳號並刪除預設帳號，以確保系統安全。
